#提取流程

## 对应地铁站点，拼音，经纬度，像素点，对应区域id（0-540）
```
get_metro_location.py 
```

## 从原始地铁数据提取od信息
```
metro_data.py
```

## 从od信息提取流量信息
```
od_flowdata.py
```

原第一次提取由于区域id范围有误，这里加了一步normal，主要对regionid-1，以及gbk编码改为utf-8；目前已经修改过上面的代码

```
normal_od.py
```

## 将生成的flow数据生成输入矩阵，里面需要手动修改taxi和metro，分别生成
```
input_data_process.py
```

## 得到541个区域之间的距离
```
dist.py
```

纽约的数据画图，及分布

```
dists.py
```

#地铁数据处理

##编码方式
原gbk，`io.open(file, encoding="gbk")`

## 地铁站点区域划分 metro_staion

地铁站点中文名称->英文名称

英文名称->经纬度

经纬度->像素点

像素点->区域编号

经纬度与像素点关联

## od数据对提取
原地铁数据格式
![](./img/1.png)
依次为乘客id，出行日期时间，地点票价

### 读入数据，存入data{}（第一个文件将data存放在了1.json）
这里先将文件读入（每个文件大致有800MB，1400w行数据，简单的统计后发现有一些id出现奇数次）考虑到上海市地铁运行可能超过24点，因此每当读取文件的时候，先将其根据id聚合，得到该id，当天所有的出行数据。

### 筛选配对的数据
对于data{}数据，key为id，value为一个list，里面为出行数据，这里考虑起点的价格为0，终点的价格非0，且一个id的出行数据应该是严格按照时间顺序排列的，因此将list按照时间顺序排序，提取od对，并删除已经配对的od信息，提取完成后，继续读取下个文件，这里由于一些奇数的情况，所以一些未配对的数据仍然存放在list中。

### od信息写入文件
id，起点，终点，起点区域编号，终点区域编号，开始时间戳，开始时间片，终止时间戳，终止时间片，起始价格，终止价格
```
2201252167	7号线上大路	1号线陕西南路	408	76	1427847540	16	1427849744	17	0.00	4.00
```
